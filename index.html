<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì—…ì†Œì‹± ë„êµ¬ - BEST ì†Œì‹±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f7fb;
      color: #222;
    }

    header {
      background: linear-gradient(90deg, #ffb74d, #ff7043);
      padding: 14px 24px;
      color: #fff;
      font-weight: 700;
    }

    main {
      max-width: 1100px;
      margin: 24px auto;
      padding: 0 16px;
    }

    .form {
      background: #fff;
      padding: 16px;
      border-radius: 12px;
      display: grid;
      grid-template-columns: 1fr 120px;
      gap: 10px;
      margin-bottom: 20px;
    }

    .form input {
      height: 36px;
      padding: 0 12px;
      border-radius: 8px;
      border: 1px solid #d0d7e2;
      font-size: 14px;
    }

    .form button {
      height: 36px;
      border-radius: 999px;
      border: none;
      background: #ff7043;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }

    .status {
      margin: 10px 0 16px;
      font-size: 13px;
      color: #666;
    }

    .list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 14px;
    }

    /* ğŸ”’ Aì•ˆ í•µì‹¬ ì¹´ë“œ */
    .card {
      background: #fff;
      border-radius: 14px;
      padding: 12px;
      display: flex;
      gap: 12px;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(0,0,0,0.06);
      transition: transform .08s ease;
    }

    .card:hover {
      transform: translateY(-2px);
    }

    .card img {
      width: 56px;
      height: 56px;
      border-radius: 10px;
      object-fit: cover;
      flex-shrink: 0;
      pointer-events: none; /* â­ ë‚´ë¶€ í´ë¦­ ì°¨ë‹¨ */
    }

    .card-info {
      pointer-events: none; /* â­ ë‚´ë¶€ í´ë¦­ ì°¨ë‹¨ */
    }

    .mall-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .product-title {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .price {
      font-size: 13px;
      color: #ff7043;
      font-weight: 600;
    }

    .empty {
      font-size: 14px;
      color: #999;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <header>ì—…ì†Œì‹± ë„êµ¬ Â· BEST ì†Œì‹±</header>

  <main>
    <form id="collectForm" class="form">
      <input id="keywordInput" placeholder="ì˜ˆ: ê²¨ìš¸ì‹ ë°œ" required />
      <button id="collectBtn">ìˆ˜ì§‘ ì‹œì‘</button>
    </form>

    <div id="status" class="status">í™•ì¥í”„ë¡œê·¸ë¨ ì—°ê²° ëŒ€ê¸° ì¤‘...</div>

    <div id="list" class="list"></div>
    <div id="empty" class="empty" style="display:none;">ìˆ˜ì§‘ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
  </main>

  <script>
    const listEl = document.getElementById("list");
    const emptyEl = document.getElementById("empty");
    const statusEl = document.getElementById("status");
    const btn = document.getElementById("collectBtn");

    let lastItems = [];

    /* ğŸ”’ Aì•ˆ: ì¹´ë“œ í´ë¦­ ê³ ì • */
    listEl.addEventListener("click", (e) => {
      const card = e.target.closest(".card");
      if (!card) return;

      e.preventDefault();
      e.stopPropagation();

      const url = card.dataset.url;
      if (url) window.open(url, "_blank", "noopener");
    });

    function render(items) {
      listEl.innerHTML = "";
      if (!items || items.length === 0) {
        emptyEl.style.display = "block";
        return;
      }
      emptyEl.style.display = "none";

      items.forEach(it => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.url = it.productUrl || it.url || "";

        card.innerHTML = `
          <img src="${it.imageUrl || "https://placehold.co/64x64?text=P"}">
          <div class="card-info">
            <div class="mall-name">${it.mallName || "UNKNOWN"}</div>
            <div class="product-title">${it.title || "-"}</div>
            <div class="price">${it.price || "-"}</div>
          </div>
        `;
        listEl.appendChild(card);
      });
    }

    /* í™•ì¥ ê²°ê³¼ ìˆ˜ì‹  */
    window.addEventListener("message", (e) => {
      if (e.data?.type !== "UPS_RESULT") return;

      const payload = e.data.payload || {};
      lastItems = payload.items || [];

      statusEl.textContent = `ì´ ${lastItems.length}ê°œ ìˆ˜ì§‘ë¨`;
      btn.disabled = false;
      btn.textContent = "ìˆ˜ì§‘ ì‹œì‘";

      render(lastItems);
    });

    /* ìˆ˜ì§‘ ìš”ì²­ */
    document.getElementById("collectForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const keyword = document.getElementById("keywordInput").value.trim();
      if (!keyword) return;

      btn.disabled = true;
      btn.textContent = "ìˆ˜ì§‘ ì¤‘...";
      statusEl.textContent = "ë„¤ì´ë²„ ì‡¼í•‘ ìˆ˜ì§‘ ì¤‘...";
      listEl.innerHTML = "";
      emptyEl.style.display = "none";

      window.postMessage({
        type: "UPS_START",
        keyword,
        maxPage: 4
      }, "*");
    });
  </script>
</body>
</html>